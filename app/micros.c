#include "stm32f1xx_hal.h"
#include "tim.h"
#include "micros.h"

////////////////////////////////////////////////////////////////////////////////
//
// module privates
//
////////////////////////////////////////////////////////////////////////////////
static TIM_HandleTypeDef*         _htim = &htim1;

////////////////////////////////////////////////////////////////////////////////
//
// private utilities
//
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//
// public interface
//
////////////////////////////////////////////////////////////////////////////////
void
micros_init(void)
{
  HAL_TIM_Base_Start(_htim);
}

uint16_t
micros(void)
{
  return __HAL_TIM_GET_COUNTER(_htim);
}
